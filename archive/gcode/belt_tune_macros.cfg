# Belt Tension Tuner Macros
# Manual pluck detection for belt frequency measurement

[gcode_macro BELT_TUNE_START]
description: Start belt frequency monitoring
gcode:
    {% set belt = params.BELT|default('A')|upper %}
    {% set position = params.POSITION|default('')|string %}
    
    RESPOND MSG="Starting belt {belt} tuning..."
    RESPOND MSG="Pluck the belt and wait for frequency reading"
    
    # Start monitoring script in background
    # This will be implemented with proper service integration
    
[gcode_macro BELT_TUNE_STOP]
description: Stop belt frequency monitoring
gcode:
    RESPOND MSG="Stopping belt tuner..."
    
[gcode_macro BELT_TUNE_ONCE]
description: Measure belt frequency once
gcode:
    {% set belt = params.BELT|default('A')|upper %}
    {% set duration = params.DURATION|default(2)|float %}
    
    RESPOND MSG="Belt {belt} - Manual pluck detection"
    RESPOND MSG="Pluck the belt now..."
    
    # Start measurement
    ACCELEROMETER_MEASURE CHIP=adxl345
    
    # Wait for pluck and decay
    G4 P{duration * 1000}
    
    # Stop and analyze
    ACCELEROMETER_MEASURE CHIP=adxl345 NAME=belt_{belt}_pluck
    
    # Python script will analyze the latest file
    # Results will be displayed via RESPOND
    
    RESPOND MSG="Analysis complete - check results above"

[gcode_macro BELT_COMPARE]
description: Compare both belt frequencies
gcode:
    RESPOND MSG="=== Belt Comparison ==="
    RESPOND MSG="Measure Belt A first..."
    BELT_TUNE_ONCE BELT=A
    
    G4 P2000  # Wait 2 seconds
    
    RESPOND MSG="Now measure Belt B..."
    BELT_TUNE_ONCE BELT=B
    
    RESPOND MSG="=== Comparison Complete ==="
